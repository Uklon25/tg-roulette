<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>AutoWin ‚Äî –†—É–ª–µ—Ç–∫–∞ –ø–æ–¥–∞—Ä–∫–æ–≤</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    html, body {
      margin: 0; padding: 0; background: #121212; color: #eee; font-family: Arial,sans-serif;
      min-height: 100vh; width: 100vw; overflow-x: hidden;
    }
    #main-content {
      flex: 1; width: 100vw; max-width: 500px; margin: 0 auto;
      box-sizing: border-box; padding-top: 16px;
      display: flex; flex-direction: column; align-items: center;
    }
    #profile, #roulette, #inventory {
      width: 100%; max-width: 500px; box-sizing: border-box; padding: 0 8px;
    }
    .rect-roulette-wrap {
      position: relative; width: 99vw; max-width: 420px; margin: 0 auto 22px auto;
      height: 110px; display: flex; flex-direction: column; align-items: center; justify-content: center;
    }
    .rect-roulette {
      display: flex; flex-direction: row; align-items: center;
      overflow: hidden; width: 100%; height: 90px; border-radius: 18px; background: #191919;
      box-shadow: 0 0 14px #0a0;
      border: 2px solid #205b20;
      position: relative;
    }
    .rect-prize {
      flex: 0 0 80px; height: 90px; display: flex; flex-direction: column; align-items: center; justify-content: center;
      font-size: 1em; transition: transform .2s;
      background: #232;
      border-right: 1px solid #205b20;
      border-left: 1px solid #205b20;
      position: relative;
    }
    .rect-prize:last-child { border-right: none; }
    .rect-prize .emoji { font-size: 2em; margin-bottom: 3px;}
    .rect-prize .label { font-size: .97em; color: #fff;}
    .rect-prize .price { font-size: .87em; color: #af8; margin-top: 1px;}
    .rect-prize.active {
      background: #35e535 !important;
      box-shadow: 0 0 10px #0f0, 0 0 0 2px #fff;
      z-index: 1;
      transform: scale(1.19);
      color: #121;
    }
    .pointer-bar-rect {
      position: absolute; left: 50%; top: -14px;
      width: 6px; height: 28px; transform: translateX(-50%);
      background: #0f0; border-radius: 5px 5px 12px 12px; box-shadow: 0 0 10px #0f0;
      z-index: 10;
    }
    #controls {
      margin-bottom: 12px; width: 100%; box-sizing: border-box; max-width: 340px;
      margin-left: auto; margin-right: auto; display: flex; flex-direction: column; align-items: center;
    }
    #luckButtons {
      display: flex; flex-wrap: wrap; justify-content: center; gap: 7px; margin-bottom: 8px;
    }
    #luckButtons button { min-width: 90px; }
    button {
      background: #0a0; color: #cfc; border: none; padding: 10px 12px; margin: 5px 3px;
      border-radius: 6px; font-weight: bold; font-size: 1em; cursor: pointer; transition: background 0.3s ease;
      min-width: 70px; box-sizing: border-box;
    }
    button:disabled { background: #444; cursor: not-allowed; }
    #balance { font-size: 1.2em; margin-bottom: 12px; text-align: center; }
    #prizeInfo { font-size: 1.1em; margin-top: 12px; min-height: 60px; text-align: center; word-break: break-word;}
    #luckButtons button.active { background: #4caf50; box-shadow: 0 0 8px #4caf50; }
    .bottom-nav {
      position: fixed; bottom: 0; left: 0; right: 0; width: 100vw; max-width: 500px; margin: 0 auto; z-index: 100;
      display: flex; justify-content: space-around; background: #222; border-top: 1px solid #333; padding: 0; height: 56px;
    }
    .bottom-nav button {
      flex: 1; margin: 0 2px; font-size: 1.05em; padding: 13px 0; border-radius: 5px;
      background: #111; color: #eee; border: none; transition: background .25s;
      min-width: 0; min-height: 36px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    .bottom-nav button.active { background: #0a0; color: #fff; box-shadow: 0 0 8px #0f0; }
    .inventory-list {
      display: flex; flex-direction: column; gap: 7px; margin-top: 10px; padding-bottom: 60px; width: 100%; align-items: stretch;
    }
    .inventory-item {
      background: #232323; border-radius: 8px; padding: 10px 10px 10px 14px; min-width: 110px;
      display: flex; align-items: center; justify-content: flex-start; color: #fff; font-size: 1em; border: 1px solid #333;
      margin: 3px 0; word-break: break-word; box-sizing: border-box;
      gap: 12px;
    }
    .profile-info { padding: 20px 0 8px 0; font-size: 1.1em; text-align: center; color: #fff; }
    .chance-table-title { text-align: center; font-size: 1.1em; margin: 12px 0 3px 0; font-weight: bold; color: #8cff8c; letter-spacing: 1px;}
    .chance-table {
      width: 100%; max-width: 350px; margin: 0 auto 10px auto; border-collapse: collapse; font-size: 0.98em;
      background: #232323; border-radius: 6px; overflow: hidden;
    }
    .chance-table th, .chance-table td { padding: 5px 4px; border: 1px solid #333; text-align: center; }
    .chance-table th { background: #191919; color: #9aff9a; font-weight: bold;}
    .chance-table td { color: #eee; }
    .chance-table tr:nth-child(even) td { background: #181818; }
    .chance-table tr:nth-child(odd) td { background: #232323; }
    .sell-all-btn {
      width: 100%; box-sizing: border-box; background: #e33; color: #fff; font-weight: bold; margin-bottom: 6px;
      padding: 12px; border-radius: 8px; font-size: 1.07em; border: none; cursor: pointer;
    }
    #tg-avatar {
      width: 72px; height: 72px; border-radius: 50%; background: #222; margin-bottom: 10px; display: none;
    }
    #addStarsBtnWrap { margin-top:12px; display:none; }
    @media (max-width: 600px) {
      #main-content, #profile, #roulette, #inventory, .bottom-nav { max-width: 100vw; min-width: 0; padding-left: 0; padding-right: 0;}
      .inventory-item { min-width: 44vw; font-size: .99em;}
      #controls { max-width: 98vw;}
      .rect-roulette-wrap, .rect-roulette { max-width: 99vw; }
      .rect-prize { flex-basis: 60px; height: 75px; font-size: .85em;}
      .bottom-nav { padding: 0; height: 54px;}
      .bottom-nav button { font-size: .97em; padding: 10px 0;}
      .chance-table { font-size: 0.9em; max-width: 100vw;}
    }
    .inv-tg-img {
      height: 28px; width:auto; border-radius: 5px; margin-left: 6px; background: #222;
    }
  </style>
</head>
<body>
<div id="main-content">
  <div id="profile" style="display:none;">
    <h2>–ü—Ä–æ—Ñ–∏–ª—å</h2>
    <div class="profile-info">
      <img id="tg-avatar" src="" alt="–ê–≤–∞—Ç–∞—Ä">
      <div>üë§ –ò–º—è: <span id="username">User</span></div>
      <div>üîó Username: <span id="usernick"></span></div>
      <div>üÜî ID: <span id="userid"></span></div>
      <div>‚≠ê –ë–∞–ª–∞–Ω—Å: <span id="balanceValueProfile">1000</span></div>
      <div id="addStarsBtnWrap">
        <button id="addStarsBtn">+1000 ‚≠ê</button>
      </div>
    </div>
  </div>
  <div id="roulette">
    <h2>–†—É–ª–µ—Ç–∫–∞ –ø–æ–¥–∞—Ä–∫–æ–≤</h2>
    <div id="balance">–ë–∞–ª–∞–Ω—Å: <span id="balanceValue">1000</span> ‚≠ê</div>
    <div class="rect-roulette-wrap">
      <div class="pointer-bar-rect"></div>
      <div class="rect-roulette" id="rectRoulette"></div>
    </div>
    <div id="controls">
      <div id="luckButtons">
        <button data-cost="25">–°—Ç–∞–≤–∫–∞ 25 ‚≠ê</button>
        <button data-cost="50">–°—Ç–∞–≤–∫–∞ 50 ‚≠ê</button>
        <button data-cost="100">–°—Ç–∞–≤–∫–∞ 100 ‚≠ê</button>
      </div>
      <div>
        <button id="spinBtn" disabled>–ö—Ä—É—Ç–∏—Ç—å</button>
        <button id="spinAgainBtn" style="display:none;">–ö—Ä—É—Ç–∏—Ç—å –µ—â—ë</button>
      </div>
    </div>
    <div id="prizeInfo"></div>
    <div class="chance-table-title">–¢–∞–±–ª–∏—Ü–∞ –ø—Ä–∏–∑–æ–≤</div>
    <div id="chanceTables"></div>
  </div>
  <div id="inventory" style="display:none;">
    <h2>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h2>
    <button class="sell-all-btn" id="sellAllBtn">–ü—Ä–æ–¥–∞—Ç—å –≤—Å—ë</button>
    <div id="inventoryCount" style="color:#eee;font-size:1.07em;margin-bottom:4px;text-align:center;width:100%"></div>
    <div id="inventoryList" class="inventory-list"></div>
  </div>
</div>
<nav class="bottom-nav">
  <button id="navProfile">–ü—Ä–æ—Ñ–∏–ª—å</button>
  <button id="navRoulette" class="active">–†—É–ª–µ—Ç–∫–∞</button>
  <button id="navInventory">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
</nav>
<script>
  // --- Telegram gift images ---
  const telegramGiftImages = {
    "–°–µ—Ä–¥—Ü–µ":  "https://emojiapi.dev/api/v1/2764/128.png",
    "–ú–∏—à–∫–∞":   "https://emojiapi.dev/api/v1/1f9f8/128.png",
    "–ö–æ—Ä–æ–±–∫–∞": "https://emojiapi.dev/api/v1/1f381/128.png",
    "–†–æ–∑–∞":    "https://emojiapi.dev/api/v1/1f339/128.png",
    "–¢–æ—Ä—Ç":    "https://emojiapi.dev/api/v1/1f382/128.png",
    "–ë—É–∫–µ—Ç":   "https://emojiapi.dev/api/v1/1f490/128.png",
    "–†–∞–∫–µ—Ç–∞":  "https://emojiapi.dev/api/v1/1f680/128.png",
    "–ö—É–±–æ–∫":   "https://emojiapi.dev/api/v1/1f3c6/128.png",
    "–ö–æ–ª—å—Ü–æ":  "https://emojiapi.dev/api/v1/1f48d/128.png",
    "–ê–ª–º–∞–∑":   "https://emojiapi.dev/api/v1/1f48e/128.png",
    "–®–∞–º–ø–∞–Ω—Å–∫–æ–µ": "https://emojiapi.dev/api/v1/1f37e/128.png",
    "–¢–∞–±–ª–∏—á–∫–∞": "img3"
  };
  const tablichkaImg = "https://files.gptgo.ai/api/image/5b06e2f3-2c1a-4e45-b1e2-2d6cd8d75615.png";

  // --- –ü—Ä–∏–∑—ã (–µ–¥–∏–Ω—ã–µ —Ü–µ–Ω—ã –¥–ª—è –≤—Å–µ—Ö —Å—Ç–∞–≤–æ–∫) ---
  const prizesData = {
    25: [
      { emoji: "üß∏", label: "–ú–∏—à–∫–∞", price: 13 },
      { emoji: "‚ù§Ô∏è", label: "–°–µ—Ä–¥—Ü–µ", price: 13 },
      { emoji: "üéÅ", label: "–ö–æ—Ä–æ–±–∫–∞", price: 21 },
      { emoji: "üåπ", label: "–†–æ–∑–∞", price: 21 },
      { emoji: "üíê", label: "–ë—É–∫–µ—Ç", price: 42 },
      { emoji: "üöÄ", label: "–†–∞–∫–µ—Ç–∞", price: 42 },
      { emoji: "üçæ", label: "–®–∞–º–ø–∞–Ω—Å–∫–æ–µ", price: 42 },
      { emoji: "üíç", label: "–ö–æ–ª—å—Ü–æ", price: 84 },
      { emoji: "üèÜ", label: "–ö—É–±–æ–∫", price: 84 },
      { emoji: "üéÇ", label: "–¢–æ—Ä—Ç", price: 84 },
      { emoji: "üíé", label: "–ê–ª–º–∞–∑", price: 84 },
      { emoji: "üéâ", label: "–¢–∞–±–ª–∏—á–∫–∞", price: 350 }
    ],
    50: [
      { emoji: "üß∏", label: "–ú–∏—à–∫–∞", price: 13 },
      { emoji: "‚ù§Ô∏è", label: "–°–µ—Ä–¥—Ü–µ", price: 13 },
      { emoji: "üéÅ", label: "–ö–æ—Ä–æ–±–∫–∞", price: 21 },
      { emoji: "üåπ", label: "–†–æ–∑–∞", price: 21 },
      { emoji: "üíê", label: "–ë—É–∫–µ—Ç", price: 42 },
      { emoji: "üöÄ", label: "–†–∞–∫–µ—Ç–∞", price: 42 },
      { emoji: "üçæ", label: "–®–∞–º–ø–∞–Ω—Å–∫–æ–µ", price: 42 },
      { emoji: "üíç", label: "–ö–æ–ª—å—Ü–æ", price: 84 },
      { emoji: "üèÜ", label: "–ö—É–±–æ–∫", price: 84 },
      { emoji: "üéÇ", label: "–¢–æ—Ä—Ç", price: 84 },
      { emoji: "üíé", label: "–ê–ª–º–∞–∑", price: 84 },
      { emoji: "üéâ", label: "–¢–∞–±–ª–∏—á–∫–∞", price: 350 }
    ],
    100: [
      { emoji: "üß∏", label: "–ú–∏—à–∫–∞", price: 13 },
      { emoji: "‚ù§Ô∏è", label: "–°–µ—Ä–¥—Ü–µ", price: 13 },
      { emoji: "üéÅ", label: "–ö–æ—Ä–æ–±–∫–∞", price: 21 },
      { emoji: "üåπ", label: "–†–æ–∑–∞", price: 21 },
      { emoji: "üíê", label: "–ë—É–∫–µ—Ç", price: 42 },
      { emoji: "üöÄ", label: "–†–∞–∫–µ—Ç–∞", price: 42 },
      { emoji: "üçæ", label: "–®–∞–º–ø–∞–Ω—Å–∫–æ–µ", price: 42 },
      { emoji: "üíç", label: "–ö–æ–ª—å—Ü–æ", price: 84 },
      { emoji: "üèÜ", label: "–ö—É–±–æ–∫", price: 84 },
      { emoji: "üéÇ", label: "–¢–æ—Ä—Ç", price: 84 },
      { emoji: "üíé", label: "–ê–ª–º–∞–∑", price: 84 },
      { emoji: "üéâ", label: "–¢–∞–±–ª–∏—á–∫–∞", price: 350 }
    ]
  };

  // === TG ADMIN IDS ===
  const TG_ADMIN_ID = 6774136020;

  let balance = 1000;
  let inventory = [];
  let currentCost = null; // –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ –Ω–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å—Ç–∞–≤–∫–∏
  let spinning = false;
  let currentPrize = null;
  let lastSpinDone = false;
  let currentPrizes = []; // –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –ø—Ä–∏–∑–æ–≤
  let tgUser = {};
  let tgUserId = null;

  function getTelegramGiftImg(label) {
    if(label === "–¢–∞–±–ª–∏—á–∫–∞") return tablichkaImg;
    const url = telegramGiftImages[label];
    if(url && url !== "img3") return url;
    if(label === "–¢–∞–±–ª–∏—á–∫–∞") return tablichkaImg;
    return null;
  }

  function updateProfile() {
    tgUser = {};
    tgUserId = null;
    let user = (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initDataUnsafe && window.Telegram.WebApp.initDataUnsafe.user);
    if (user) {
      tgUser = user;
      tgUserId = user.id;
    } else {
      tgUser = {first_name: "Uklon", username: "Uklon25", id: 6774136020};
      tgUserId = tgUser.id;
    }
    document.getElementById("username").textContent = tgUser.first_name || "–ì–æ—Å—Ç—å";
    document.getElementById("usernick").textContent = tgUser.username || "";
    document.getElementById("userid").textContent = tgUser.id || "";
    let avatar = document.getElementById("tg-avatar");
    if (tgUser.photo_url) {
      avatar.src = tgUser.photo_url;
      avatar.style.display = "";
    } else {
      avatar.style.display = "none";
    }
    // –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–Ω–æ–ø–∫—É —Ç–æ–ª—å–∫–æ –¥–ª—è –º–æ–µ–≥–æ ID
    if (tgUserId === TG_ADMIN_ID) {
      document.getElementById("addStarsBtnWrap").style.display = "";
    } else {
      document.getElementById("addStarsBtnWrap").style.display = "none";
    }
    document.getElementById("balanceValueProfile").textContent = balance;
  }
  function updateInventory() {
    const invList = document.getElementById('inventoryList');
    invList.innerHTML = "";
    if (inventory.length === 0) {
      invList.innerHTML = `<div style="color:#888;">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç.</div>`;
      document.getElementById('sellAllBtn').disabled = true;
      return;
    }
    document.getElementById('sellAllBtn').disabled = false;
    inventory.forEach(item => {
      let div = document.createElement("div");
      div.className = "inventory-item";
      let tgImg = getTelegramGiftImg(item.label);
      div.innerHTML = `
        <span>${item.emoji} ${item.label} <span style="color:#aaa;">(${item.price} ‚≠ê)</span></span>
        ${tgImg ? `<img src="${tgImg}" class="inv-tg-img" alt="tg-img" />` : ""}
      `;
      invList.appendChild(div);
    });
  }
  function updateInventoryCount() {
    document.getElementById('inventoryCount').textContent =
      `üéÅ –ü—Ä–µ–¥–º–µ—Ç–æ–≤ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ: ${inventory.length}`;
  }

  const balanceElem = document.getElementById("balanceValue");
  const prizeInfo = document.getElementById("prizeInfo");
  const luckButtons = [...document.querySelectorAll("#luckButtons button")];
  const spinBtn = document.getElementById("spinBtn");
  const spinAgainBtn = document.getElementById("spinAgainBtn");
  const sellAllBtn = document.getElementById("sellAllBtn");

  // ========== –†—É–ª–µ—Ç–∫–∞ ==========
  const inViewCount = 7;

  let rectAnim = {
    offset: 0, target: 0, running: false, startOffset: 0, startTime: 0, duration: 0,
    prizeIdx: 0, lastPrizeIdx: 0
  };

  function renderRectRoulette(activeIdx, prizesArr) {
    const wrap = document.getElementById("rectRoulette");
    wrap.innerHTML = "";
    for(let i=0; i<prizesArr.length; ++i) {
      const p = prizesArr[i];
      let div = document.createElement("div");
      div.className = "rect-prize" + (i === activeIdx ? " active" : "");
      div.innerHTML = `
        <span class="emoji">${p.emoji}</span>
        <span class="label">${p.label}</span>
        <span class="price">${p.price} ‚≠ê</span>
      `;
      wrap.appendChild(div);
    }
  }

  function getPrizeIdxAndView(prizes) {
    const winIdx = Math.floor(Math.random() * prizes.length);
    let arr = [];
    let n = prizes.length;
    let circles = 3;
    for(let i=0;i<circles;i++) arr = arr.concat(prizes);
    let viewOffset = Math.floor(inViewCount/2);
    let start = prizes.length + winIdx - viewOffset;
    let visible = arr.slice(start, start+inViewCount+6);
    let active = viewOffset;
    return { winIdx, visible, active };
  }

  function animateRectRoulette(visibleArr, winIdxInAll, cb) {
    const wrap = document.getElementById("rectRoulette");
    let prizeW = wrap.firstChild ? wrap.firstChild.offsetWidth : 80;
    let viewOffset = Math.floor(inViewCount/2);
    let total = visibleArr.length;
    let targetOffset = prizeW * (winIdxInAll - viewOffset);
    rectAnim.running = true;
    rectAnim.startTime = performance.now();
    rectAnim.duration = 1800 + Math.random()*1000;
    rectAnim.startOffset = rectAnim.offset;
    rectAnim.target = targetOffset;

    function step(now) {
      let t = (now - rectAnim.startTime) / rectAnim.duration;
      if (t > 1) t = 1;
      let ease = 1 - Math.pow(1-t,3);
      rectAnim.offset = rectAnim.startOffset + (rectAnim.target-rectAnim.startOffset)*ease;
      wrap.style.transform = `translateX(${-rectAnim.offset}px)`;
      let idx = Math.round(rectAnim.offset/prizeW) + viewOffset;
      let children = wrap.children;
      for(let i=0;i<children.length;++i) children[i].classList.toggle("active", i===viewOffset);
      if (t < 1) {
        requestAnimationFrame(step);
      } else {
        rectAnim.running = false;
        wrap.style.transform = `translateX(${-rectAnim.target}px)`;
        for(let i=0;i<children.length;++i) children[i].classList.toggle("active", i===viewOffset);
        cb && cb(viewOffset);
      }
    }
    requestAnimationFrame(step);
  }

  function startRectRouletteSpin() {
    if (spinning) return;
    spinning = true;
    updateButtonsState();
    const {winIdx, visible, active} = getPrizeIdxAndView(currentPrizes);
    renderRectRoulette(-1, visible);
    setTimeout(() => {
      animateRectRoulette(visible, active + Math.floor(Math.random()*2), (centerIdx) => {
        spinning = false;
        updateButtonsState();
        let winPrize = visible[centerIdx];
        showPrizeRect(winPrize);
        const invId = Math.random().toString(36).slice(2) + Date.now();
        inventory.push({ ...winPrize, invId });
        updateInventory();
        updateInventoryCount();
      });
    }, 10);
  }

  function showPrizeRect(prize) {
    if (!prize || !prize.label) {
      prizeInfo.innerHTML = `–£–≤—ã, –ø—É—Å—Ç–æ.`;
      return;
    }
    let tgImg = getTelegramGiftImg(prize.label);
    prizeInfo.innerHTML = `–í–∞—à –ø—Ä–∏–∑: <span style="font-size:1.28em">${prize.emoji} ${prize.label}</span><br>
      –¶–µ–Ω–∞: <b>${prize.price}‚≠ê</b>` +
      (tgImg
        ? `<div style="margin-top:7px;margin-bottom:0.5em">
            Telegram-—Å—Ç–∏–∫–µ—Ä:<br>
            <img id="prizeEmojiImg" src="${tgImg}" alt="tg-img" style="height:54px;max-width:90px;display:block;margin:7px auto 0 auto;">
          </div>`
        : "");
  }

  function updateButtonsState() {
    if (spinning) {
      spinBtn.style.display = "none";
      spinAgainBtn.style.display = "none";
      luckButtons.forEach(btn => btn.disabled = true);
      return;
    }
    if (lastSpinDone) {
      spinBtn.style.display = "none";
      spinAgainBtn.style.display = "";
    } else {
      spinBtn.style.display = "";
      spinAgainBtn.style.display = "none";
    }
    // –ö–Ω–æ–ø–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞ –µ—Å–ª–∏ –µ—Å—Ç—å —Å—Ç–∞–≤–∫–∞ –∏ —Ö–≤–∞—Ç–∞–µ—Ç –±–∞–ª–∞–Ω—Å–∞
    spinBtn.disabled = !currentCost || balance < currentCost;
    spinAgainBtn.disabled = !currentCost || balance < currentCost;
    luckButtons.forEach(btn => btn.disabled = spinning);
  }

  luckButtons.forEach(btn => {
    btn.addEventListener("click", () => {
      if (spinning) return;
      luckButtons.forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      currentCost = +btn.dataset.cost;
      currentPrizes = prizesData[currentCost].map(x => ({...x}));
      currentPrize = null;
      lastSpinDone = false;
      prizeInfo.textContent = "";
      updateButtonsState();
      renderRectRoulette(Math.floor(inViewCount/2), getPrizeIdxAndView(currentPrizes).visible);
      renderChanceTableOnly(currentCost);
    });
  });

  spinBtn.addEventListener("click", () => {
    if (spinning || !currentCost) return;
    if (balance < currentCost) {
      alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–∞–Ω—Å–∞ –¥–ª—è —Å—Ç–∞–≤–∫–∏!");
      return;
    }
    balance -= currentCost;
    updateBalanceUI();
    startRectRouletteSpin();
    lastSpinDone = true;
    updateButtonsState();
  });

  spinAgainBtn.addEventListener("click", () => {
    if (spinning || !currentCost || balance < currentCost) return;
    prizeInfo.textContent = "";
    balance -= currentCost;
    updateBalanceUI();
    startRectRouletteSpin();
    lastSpinDone = true;
    updateButtonsState();
  });

  sellAllBtn.onclick = function() {
    if (inventory.length === 0) return;
    let sum = 0;
    inventory.forEach(item => { sum += item.price; });
    balance += sum;
    updateBalanceUI();
    inventory = [];
    updateInventory();
    updateInventoryCount();
  };

  document.getElementById("addStarsBtn").onclick = function () {
    balance += 1000;
    updateBalanceUI();
    updateProfile();
  };

  function renderChanceTableOnly(cost) {
    let html = `<div style="margin-bottom:9px;"><b>–°—Ç–∞–≤–∫–∞ ${cost} ‚≠ê</b><table class="chance-table"><tr><th>–ü—Ä–∏–∑</th><th>–¶–µ–Ω–∞</th></tr>`;
    // –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è —ç—Ç–æ–π —Å—Ç–∞–≤–∫–∏
    if (prizesData[cost]) {
      prizesData[cost].forEach(item => {
        html += `<tr><td>${item.emoji} ${item.label}</td><td>${item.price ? item.price + " ‚≠ê" : "-"}</td></tr>`;
      });
    } else {
      html += `<tr><td colspan="2">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç—Ç–æ–π —Å—Ç–∞–≤–∫–∏</td></tr>`;
    }
    html += `</table></div>`;
    document.getElementById('chanceTables').innerHTML = html;
  }

  const navBtns = {
    profile: document.getElementById("navProfile"),
    roulette: document.getElementById("navRoulette"),
    inventory: document.getElementById("navInventory"),
  };
  const screens = {
    profile: document.getElementById("profile"),
    roulette: document.getElementById("roulette"),
    inventory: document.getElementById("inventory"),
  };
  function showScreen(screen) {
    for (let k of Object.keys(screens)) {
      screens[k].style.display = (k === screen) ? "" : "none";
      navBtns[k].classList.toggle("active", k === screen);
    }
    if (screen === "profile") updateProfile();
    if (screen === "inventory") { updateInventory(); updateInventoryCount(); }
  }
  navBtns.profile.onclick = () => showScreen("profile");
  navBtns.roulette.onclick = () => showScreen("roulette");
  navBtns.inventory.onclick = () => showScreen("inventory");

  // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
  updateBalanceUI();
  updateProfile();

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä—É–ª–µ—Ç–∫–∏
  luckButtons.forEach(btn => {
    btn.addEventListener("click", () => {
        if (spinning) return;
        luckButtons.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        currentCost = +btn.dataset.cost;
        currentPrizes = prizesData[currentCost].map(x => ({...x}));
        currentPrize = null;
        lastSpinDone = false;
        prizeInfo.textContent = "";
        updateButtonsState();
        renderRectRoulette(Math.floor(inViewCount/2), getPrizeIdxAndView(currentPrizes).visible);
        renderChanceTableOnly(currentCost);
    });
  });
  // –í—ã–±–æ—Ä –Ω–∞—á–∞–ª—å–Ω–æ–π —Å—Ç–∞–≤–∫–∏ (25)
  luckButtons[0].click();

  showScreen('roulette');
  updateInventory();
  updateInventoryCount();
  renderChanceTableOnly(currentCost);
  updateButtonsState();
</script>
</body>
</html>
