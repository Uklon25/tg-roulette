<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>–†—É–ª–µ—Ç–∫–∞ –ü–æ–¥–∞—Ä–∫–æ–≤</title>
<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    margin: 20px;
  }
  #roulette-container {
    position: relative;
    width: 420px;
    overflow: hidden;
    margin: 20px auto;
    border: 2px solid #333;
    border-radius: 10px;
  }
  #roulette-strip {
    display: flex;
    transition: transform 5s cubic-bezier(0.33, 1, 0.68, 1);
  }
  .roulette-item {
    width: 80px;
    height: 80px;
    line-height: 80px;
    margin: 0 2px;
    font-size: 30px;
    background: #f0f0f0;
    border-radius: 8px;
    user-select: none;
  }
  #pointer {
    position: absolute;
    top: -15px;
    left: 50%;
    transform: translateX(-50%);
    width: 0; 
    height: 0; 
    border-left: 15px solid transparent;
    border-right: 15px solid transparent;
    border-bottom: 15px solid red;
    z-index: 10;
  }
  button {
    margin: 10px 5px;
    padding: 10px 20px;
    font-size: 16px;
  }
  #after-spin-controls {
    margin-top: 20px;
    display: none;
  }
  #balance {
    font-weight: bold;
    font-size: 20px;
  }
  #inventory {
    margin-top: 30px;
  }
  #inventory-list {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 10px;
  }
  .inventory-item {
    background: #ddd;
    border-radius: 6px;
    padding: 5px 10px;
    font-size: 24px;
    user-select: none;
  }
  #admin-controls {
    margin-top: 20px;
  }
</style>
</head>
<body>

<h1>–†—É–ª–µ—Ç–∫–∞ –ü–æ–¥–∞—Ä–∫–æ–≤</h1>
<div>–ë–∞–ª–∞–Ω—Å –∑–≤–µ–∑–¥: <span id="balance">1000</span></div>

<label>
  –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞–≤–∫—É:
  <select id="star-select">
    <option value="25">25 –∑–≤–µ–∑–¥</option>
    <option value="50">50 –∑–≤–µ–∑–¥</option>
    <option value="100">100 –∑–≤–µ–∑–¥</option>
  </select>
</label>

<div id="roulette-container">
  <div id="pointer"></div>
  <div id="roulette-strip"></div>
</div>

<button id="spin-btn">–ö—Ä—É—Ç–∏—Ç—å —Ä—É–ª–µ—Ç–∫—É</button>

<div id="after-spin-controls">
  <button id="sell-btn">–ü—Ä–æ–¥–∞—Ç—å –ø—Ä–∏–∑</button>
  <button id="spin-again-btn">–ö—Ä—É—Ç–∏—Ç—å –µ—â—ë —Ä–∞–∑</button>
</div>

<div id="admin-controls" style="display:none;">
  <button id="add-stars-btn">+1000 –∑–≤–µ–∑–¥ (–ê–¥–º–∏–Ω)</button>
</div>

<h2>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h2>
<div id="inventory-list"></div>

<script>
  const userId = "6774136020"; // –¢–≤–æ–π ID –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

  const chances = {
    "25": [
      ["üß∏ –ü–ª—é—à–µ–≤—ã–π –º–∏—à–∫–∞", 21.37],
      ["‚ù§Ô∏è –°–µ—Ä–¥—Ü–µ —Å –±–∞–Ω—Ç–æ–º", 21.37],
      ["üéÅ –ü–æ–¥–∞—Ä–æ—á–Ω–∞—è –∫–æ—Ä–æ–±–∫–∞", 25],
      ["üåπ –ö—Ä–∞—Å–Ω–∞—è —Ä–æ–∑–∞", 25],
      ["üöÄ –†–∞–∫–µ—Ç–∞", 1.21],
      ["üçæ –®–∞–º–ø–∞–Ω—Å–∫–æ–µ", 1.21],
      ["üíç –ö–æ–ª—å—Ü–æ —Å –±—Ä–∏–ª–ª–∏–∞–Ω—Ç–æ–º", 0.86],
      ["‚ùå –ü—É—Å—Ç–∞—è —è—á–µ–π–∫–∞", 4.98]
    ],
    "50": [
      ["üß∏ –ü–ª—é—à–µ–≤—ã–π –º–∏—à–∫–∞", 8.08],
      ["‚ù§Ô∏è –°–µ—Ä–¥—Ü–µ —Å –±–∞–Ω—Ç–æ–º", 8.08],
      ["üéÅ –ü–æ–¥–∞—Ä–æ—á–Ω–∞—è –∫–æ—Ä–æ–±–∫–∞", 13.47],
      ["üåπ –ö—Ä–∞—Å–Ω–∞—è —Ä–æ–∑–∞", 13.47],
      ["üíê –ë—É–∫–µ—Ç —Ü–≤–µ—Ç–æ–≤", 12.5],
      ["üöÄ –†–∞–∫–µ—Ç–∞", 12.5],
      ["üçæ –®–∞–º–ø–∞–Ω—Å–∫–æ–µ", 12.5],
      ["üíç –ö–æ–ª—å—Ü–æ —Å –±—Ä–∏–ª–ª–∏–∞–Ω—Ç–æ–º", 1.48],
      ["üèÜ –ö—É–±–æ–∫", 1.48],
      ["üéÇ –¢–æ—Ä—Ç —Å —Å–≤–µ—á–∞–º–∏", 12.5],
      ["‚ùå –ü—É—Å—Ç–∞—è —è—á–µ–π–∫–∞", 4.94]
    ],
    "100": [
      ["üß∏ –ü–ª—é—à–µ–≤—ã–π –º–∏—à–∫–∞", 3.61],
      ["‚ù§Ô∏è –°–µ—Ä–¥—Ü–µ —Å –±–∞–Ω—Ç–æ–º", 3.61],
      ["üéÅ –ü–æ–¥–∞—Ä–æ—á–Ω–∞—è –∫–æ—Ä–æ–±–∫–∞", 8.02],
      ["üåπ –ö—Ä–∞—Å–Ω–∞—è —Ä–æ–∑–∞", 8.02],
      ["üíê –ë—É–∫–µ—Ç —Ü–≤–µ—Ç–æ–≤", 8.35],
      ["üöÄ –†–∞–∫–µ—Ç–∞", 8.35],
      ["üçæ –®–∞–º–ø–∞–Ω—Å–∫–æ–µ", 8.02],
      ["üíç –ö–æ–ª—å—Ü–æ —Å –±—Ä–∏–ª–ª–∏–∞–Ω—Ç–æ–º", 16],
      ["üèÜ –ö—É–±–æ–∫", 16],
      ["üéÇ –¢–æ—Ä—Ç —Å —Å–≤–µ—á–∞–º–∏", 7.02],
      ["üíé –ê–ª–º–∞–∑", 16],
      ["üéâ Happy B-day —Ç–∞–±–ª–∏—á–∫–∞", 4],
      ["‚ùå –ü—É—Å—Ç–∞—è —è—á–µ–π–∫–∞", 1]
    ]
  };

  const prizeCost = {
    "üß∏ –ü–ª—é—à–µ–≤—ã–π –º–∏—à–∫–∞": 15,
    "‚ù§Ô∏è –°–µ—Ä–¥—Ü–µ —Å –±–∞–Ω—Ç–æ–º": 15,
    "üéÅ –ü–æ–¥–∞—Ä–æ—á–Ω–∞—è –∫–æ—Ä–æ–±–∫–∞": 25,
    "üåπ –ö—Ä–∞—Å–Ω–∞—è —Ä–æ–∑–∞": 25,
    "üöÄ –†–∞–∫–µ—Ç–∞": 50,
    "üçæ –®–∞–º–ø–∞–Ω—Å–∫–æ–µ": 50,
    "üíç –ö–æ–ª—å—Ü–æ —Å –±—Ä–∏–ª–ª–∏–∞–Ω—Ç–æ–º": 100,
    "‚ùå –ü—É—Å—Ç–∞—è —è—á–µ–π–∫–∞": 0,
    "üíê –ë—É–∫–µ—Ç —Ü–≤–µ—Ç–æ–≤": 50,
    "üèÜ –ö—É–±–æ–∫": 100,
    "üéÇ –¢–æ—Ä—Ç —Å —Å–≤–µ—á–∞–º–∏": 50,
    "üíé –ê–ª–º–∞–∑": 100,
    "üéâ Happy B-day —Ç–∞–±–ª–∏—á–∫–∞": 350
  };

  let balance = 1000;
  let selectedStars = "25";
  let spinning = false;
  let lastPrize = null;
  let inventory = [];

  const balanceEl = document.getElementById('balance');
  const starSelect = document.getElementById('star-select');
  const spinBtn = document.getElementById('spin-btn');
  const rouletteStrip = document.getElementById('roulette-strip');
  const afterSpinControls = document.getElementById('after-spin-controls');
  const sellBtn = document.getElementById('sell-btn');
  const spinAgainBtn = document.getElementById('spin-again-btn');
  const inventoryList = document.getElementById('inventory-list');
  const adminControls = document.getElementById('admin-controls');
  const addStarsBtn = document.getElementById('add-stars-btn');

  // –ö–æ–ø–∏—è —à–∞–Ω—Å–æ–≤ –¥–ª—è –¥–∏–Ω–∞–º–∏–∫–∏
  let dynamicChances = JSON.parse(JSON.stringify(chances));

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º ID –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –∞–¥–º–∏–Ω–∞
  function checkAdmin() {
    // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –≤–º–µ—Å—Ç–æ '6774136020' –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π ID —é–∑–µ—Ä–∞ –∏–∑ —Å–µ—Å—Å–∏–∏ –∏–ª–∏ API
    if (userId === "6774136020") {
      adminControls.style.display = "block";
    }
  }

  starSelect.addEventListener('change', () => {
    selectedStars = starSelect.value;
  });

  function updateBalance() {
    balanceEl.textContent = balance;
  }

  function updateInventory() {
    inventoryList.innerHTML = '';
    inventory.forEach(prize => {
      const item = document.createElement('div');
      item.className = 'inventory-item';
      item.textContent = prize;
      inventoryList.appendChild(item);
    });
  }

  function adjustChances() {
    const increaseFactor = 1.05;  // +5% –∫ –æ–±—ã—á–Ω—ã–º –ø—Ä–∏–∑–∞–º
    const decreaseFactor = 0.85;  // -15% –∫ –¥–æ—Ä–æ–≥–∏–º –ø—Ä–∏–∑–∞–º

    for (const key of Object.keys(dynamicChances)) {
      let total = 0;
      dynamicChances[key] = dynamicChances[key].map(([prize, chance]) => {
        const cost = prizeCost[prize] || 0;
        let newChance = chance;
        if (cost >= 50) {
          newChance = chance * decreaseFactor;
          if (newChance < 0.5) newChance = 0.5;
        } else if (cost >= 15 && cost < 50) {
          newChance = chance * increaseFactor;
          if (newChance > 40) newChance = 40;
        }
        total += newChance;
        return [prize, newChance];
      });
      dynamicChances[key] = dynamicChances[key].map(([prize, chance]) => {
        return [prize, (chance / total) * 100];
      });
    }
  }

  function pickPrize() {
    const prizes = dynamicChances[selectedStars];
    const rand = Math.random() * 100;
    let sum = 0;
    for (const [prize, chance] of prizes) {
      sum += chance;
      if (rand <= sum) {
        return prize;
      }
    }
    return prizes[prizes.length - 1][0];
  }

  function startRoulette() {
    if (spinning || !selectedStars) return;
    if (balance < +selectedStars) {
      alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤—ë–∑–¥ –¥–ª—è –∫—Ä—É—á–µ–Ω–∏—è!");
      return;
    }
    spinning = true;
    balance -= +selectedStars;
    updateBalance();

    adjustChances();

    const stripItems = [];
    for (let i = 0; i < 30; i++) {
      stripItems.push(pickPrize());
    }
    lastPrize = stripItems[stripItems.length - 1];

    rouletteStrip.innerHTML = '';
    stripItems.forEach(prize => {
      const el = document.createElement('div');
      el.className = 'roulette-item';
      el.textContent = prize;
      rouletteStrip.appendChild(el);
    });

    const itemWidth = 84;
    const distance = itemWidth * (stripItems.length - 5);

    rouletteStrip.style.transition = 'transform 5s cubic-bezier(0.33, 1, 0.68, 1)';
    rouletteStrip.style.transform = `translateX(-${distance}px)`;

    spinBtn.disabled = true;
    sellBtn.style.display = 'none';
    spinAgainBtn.style.display = 'none';
    afterSpinControls.style.display = 'none';

    setTimeout(() => {
      spinning = false;
      spinBtn.disabled = false;

      afterSpinControls.style.display = 'flex';
      if (lastPrize === "‚ùå –ü—É—Å—Ç–∞—è —è—á–µ–π–∫–∞") {
        sellBtn.style.display = 'none';
      } else {
        sellBtn.style.display = 'inline-block';
      }
      spinAgainBtn.style.display = 'inline-block';

      alert(`–í—ã–ø–∞–ª –ø—Ä–∏–∑: ${lastPrize}`);
    }, 5200);
  }

  spinBtn.addEventListener('click', startRoulette);

  sellBtn.addEventListener('click', () => {
    if (!lastPrize || lastPrize === "‚ùå –ü—É—Å—Ç–∞—è —è—á–µ–π–∫–∞") return;
    const cost = prizeCost[lastPrize] || 0;
    balance += cost;
    updateBalance();
    alert(`–í—ã –ø—Ä–æ–¥–∞–ª–∏ ${lastPrize} –∑–∞ ${cost} –∑–≤–µ–∑–¥.`);
    lastPrize = null;
    afterSpinControls.style.display = 'none';
  });

  spinAgainBtn.addEventListener('click', () => {
    if (!lastPrize) return;
    if (lastPrize !== "‚ùå –ü—É—Å—Ç–∞—è —è—á–µ–π–∫–∞") {
      inventory.push(lastPrize);
      updateInventory();
      alert(`–ü—Ä–∏–∑ ${lastPrize} –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å.`);
    }
    lastPrize = null;
    afterSpinControls.style.display = 'none';
    rouletteStrip.style.transition = 'none';
    rouletteStrip.style.transform = 'translateX(0)';
  });

  addStarsBtn.addEventListener('click', () => {
    balance += 1000;
    updateBalance();
    alert('–î–æ–±–∞–≤–ª–µ–Ω–æ +1000 –∑–≤–µ–∑–¥ (–∞–¥–º–∏–Ω)');
  });

  // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –∞–¥–º–∏–Ω–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
  checkAdmin();

  updateBalance();
  updateInventory();
</script>

</body>
</html>
