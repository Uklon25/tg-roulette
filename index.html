<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üé∞ –†—É–ª–µ—Ç–∫–∞ –ü–æ–¥–∞—Ä–∫–æ–≤</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #121212;
      color: #fff;
      margin: 0;
      padding-bottom: 80px;
    }
    h1, h2 {
      text-align: center;
    }
    .buttons, .controls {
      margin: 20px;
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    button {
      padding: 10px 16px;
      font-size: 16px;
      background: linear-gradient(45deg, #ff9800, #e68900);
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    button:hover {
      transform: scale(1.05);
    }
    .roulette-container {
      display: flex;
      justify-content: center;
      margin: 30px 0;
    }
    .roulette {
      width: 320px;
      height: 100px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 3px solid #ff9800;
      background: #333;
      overflow: hidden;
      border-radius: 10px;
      font-size: 18px;
      font-weight: bold;
      color: #ffeb3b;
      position: relative;
    }
    .table-container {
      margin: 20px auto;
      width: 90%;
      max-width: 500px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background-color: #1e1e1e;
      border: 2px solid #ff9800;
    }
    th, td {
      border: 1px solid #fff;
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #ff9800;
    }
    #afterSpin {
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 10px;
    }
    #inventory {
      margin: 20px auto;
      text-align: center;
      max-width: 500px;
      display: none;
    }
    #inventory ul {
      list-style: none;
      padding: 0;
    }
    #inventory li {
      margin: 5px 0;
      padding: 5px;
      background-color: #2a2a2a;
      border: 1px solid #ff9800;
      border-radius: 6px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background-color: #1e1e1e;
      border-top: 2px solid #ff9800;
      display: flex;
      justify-content: space-around;
      align-items: center;
      padding: 10px 0;
      z-index: 1000;
    }
    .bottom-nav button {
      background: none;
      color: #fff;
      font-size: 16px;
      border: none;
    }
    .bottom-nav button.active {
      color: #ff9800;
      font-weight: bold;
    }
    #inventoryControls {
      margin-bottom: 10px;
    }
    #profile {
      display: none;
      text-align: center;
      padding: 20px;
    }
    #profile img {
      width: 80px;
      border-radius: 50%;
      margin-bottom: 10px;
    }
    #adminPanel {
      margin-top: 20px;
    }
  </style>
</head>
<body>

  <h1>üé∞ –†—É–ª–µ—Ç–∫–∞ –ü–æ–¥–∞—Ä–∫–æ–≤</h1>
  <h2>–ë–∞–ª–∞–Ω—Å: <span id="balance">0</span> –∑–≤—ë–∑–¥</h2>

  <div id="roulettePage">
    <div class="buttons">
      <button onclick="selectRoulette('25')">üé∞ 25 –∑–≤—ë–∑–¥</button>
      <button onclick="selectRoulette('50')">üé∞ 50 –∑–≤—ë–∑–¥</button>
      <button onclick="selectRoulette('100')">üé∞ 100 –∑–≤—ë–∑–¥</button>
    </div>

    <div class="roulette-container">
      <div class="roulette" id="roulette">üéÅ –í—ã–±–µ—Ä–∏—Ç–µ —Ä—É–ª–µ—Ç–∫—É!</div>
    </div>

    <div class="controls" id="controls">
      <button onclick="startRoulette()">üîÑ –ö—Ä—É—Ç–∏—Ç—å!</button>
    </div>

    <div class="controls" id="afterSpin">
      <button onclick="sellPrize()">üí∞ –ü—Ä–æ–¥–∞—Ç—å</button>
      <button onclick="storePrize()">üì¶ –û—Ç–ª–æ–∂–∏—Ç—å</button>
      <button onclick="resetRoulette()">‚¨Ö –í–µ—Ä–Ω—É—Ç—å—Å—è</button>
    </div>

    <div class="table-container" id="tableContainer"></div>
  </div>

  <div class="table-container" id="inventory">
    <h2>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å:</h2>
    <div id="inventoryControls">
      <button onclick="sellAllPrizes()">üí∞ –ü—Ä–æ–¥–∞—Ç—å –≤—Å—ë</button>
    </div>
    <ul id="inventoryList"></ul>
  </div>

  <div id="profile">
    <img id="userPic" src="" alt="avatar">
    <h2 id="userName">–ü—Ä–æ—Ñ–∏–ª—å</h2>
    <button onclick="alert('–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ CryptoBot –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')">üíé –ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
    <div id="adminPanel" style="display:none">
      <button onclick="addAdminStars()">üíé +1000 –∑–≤—ë–∑–¥ (–ê–¥–º–∏–Ω)</button>
    </div>
  </div>

  <div class="bottom-nav">
    <button onclick="showSection('profile')">üë§ –ü—Ä–æ—Ñ–∏–ª—å</button>
    <button onclick="showSection('inventory')">üì¶ –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
    <button class="active" onclick="showSection('roulettePage')">üé∞ –†—É–ª–µ—Ç–∫–∞</button>
  </div>

  <script>
    const ADMIN_ID = 6774136020;
    const userData = Telegram.WebApp.initDataUnsafe.user;

    let balance = userData.id === ADMIN_ID ? 1000 : 0;
    let inventory = JSON.parse(localStorage.getItem('inventory')) || [];
    let selectedStars = null;
    let lastPrize = "";

    const chances = {
      "25": [["üç¨ –ö–æ–Ω—Ñ–µ—Ç–∞", 50], ["üç´ –®–æ–∫–æ–ª–∞–¥", 30], ["üéâ –°—é—Ä–ø—Ä–∏–∑", 15], ["üíé –î–∂–µ–∫–ø–æ—Ç", 5]],
      "50": [["üç´ –®–æ–∫–æ–ª–∞–¥", 40], ["üéÅ –ü–æ–¥–∞—Ä–æ–∫", 35], ["üéâ –°—é—Ä–ø—Ä–∏–∑", 20], ["üíé –î–∂–µ–∫–ø–æ—Ç", 5]],
      "100": [["üéÅ –ü–æ–¥–∞—Ä–æ–∫", 45], ["üéâ –°—é—Ä–ø—Ä–∏–∑", 30], ["üéÆ –ò–≥—Ä—É—à–∫–∞", 20], ["üíé –î–∂–µ–∫–ø–æ—Ç", 5]]
    };

    function updateBalance() {
      document.getElementById("balance").textContent = balance;
      localStorage.setItem('balance', balance);
    }

    function selectRoulette(stars) {
      selectedStars = stars;
      document.getElementById("tableContainer").innerHTML = generateTable(stars);
      document.getElementById("roulette").textContent = `üé∞ –ì–æ—Ç–æ–≤–æ! –ù–∞–∂–º–∏—Ç–µ \"–ö—Ä—É—Ç–∏—Ç—å\"`;
      document.getElementById("controls").style.display = "flex";
      document.getElementById("afterSpin").style.display = "none";
    }

    function generateTable(stars) {
      const rows = chances[stars].map(([name, chance]) => `<tr><td>${name}</td><td>${chance}%</td></tr>`).join('');
      return `<table><tr><th>–ü—Ä–∏–∑</th><th>–®–∞–Ω—Å</th></tr>${rows}</table>`;
    }

    function startRoulette() {
      if (!selectedStars || balance < parseInt(selectedStars)) return alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤—ë–∑–¥");
      balance -= parseInt(selectedStars);
      updateBalance();
      const items = chances[selectedStars];
      const rnd = Math.random() * 100;
      let sum = 0;
      for (let item of items) {
        sum += item[1];
        if (rnd <= sum) {
          lastPrize = item[0];
          break;
        }
      }
      const roulette = document.getElementById("roulette");
      roulette.textContent = "";
      roulette.style.transition = "none";
      roulette.innerHTML = `<div style='display:flex;gap:10px;transform:translateX(0);transition:transform 2s ease;'>${Array(20).fill(items.map(i => `<div>${i[0]}</div>`).join('')).join('')}</div>`;
      const inner = roulette.firstChild;
      setTimeout(() => {
        inner.style.transform = `translateX(-${Math.floor(Math.random() * 3000 + 2000)}px)`;
        setTimeout(() => {
          roulette.textContent = lastPrize;
          document.getElementById("afterSpin").style.display = "flex";
        }, 2100);
      }, 50);
    }

    function sellPrize() {
      balance += Math.floor(selectedStars / 2);
      updateBalance();
      resetRoulette();
    }

    function storePrize() {
      inventory.push(lastPrize);
      updateInventory();
      resetRoulette();
    }

    function updateInventory() {
      const list = document.getElementById("inventoryList");
      list.innerHTML = "";
      inventory.forEach((item, i) => {
        list.innerHTML += `<li>${item} <button onclick="sellSinglePrize(${i})">üí∞ –ü—Ä–æ–¥–∞—Ç—å</button></li>`;
      });
      localStorage.setItem('inventory', JSON.stringify(inventory));
    }

    function sellSinglePrize(index) {
      inventory.splice(index, 1);
      balance += 10;
      updateBalance();
      updateInventory();
    }

    function sellAllPrizes() {
      balance += inventory.length * 10;
      inventory = [];
      updateBalance();
      updateInventory();
    }

    function resetRoulette() {
      document.getElementById("roulette").textContent = "üé∞ –ì–æ—Ç–æ–≤–æ! –ù–∞–∂–º–∏—Ç–µ \"–ö—Ä—É—Ç–∏—Ç—å\"";
      document.getElementById("afterSpin").style.display = "none";
    }

    function showSection(id) {
      document.getElementById("roulettePage").style.display = id === "roulettePage" ? "block" : "none";
      document.getElementById("inventory").style.display = id === "inventory" ? "block" : "none";
      document.getElementById("profile").style.display = id === "profile" ? "block" : "none";
      document.querySelector(".bottom-nav button.active").classList.remove("active");
      document.querySelector(`.bottom-nav button[onclick*='${id}']`).classList.add("active");
    }

    function addAdminStars() {
      balance += 1000;
      updateBalance();
    }

    window.Telegram.WebApp.ready();
    if (userData) {
      document.getElementById('userName').textContent = userData.first_name + ' ' + (userData.last_name || '');
      document.getElementById('userPic').src = userData.photo_url;
      if (userData.id === ADMIN_ID) {
        document.getElementById("adminPanel").style.display = "block";
      }
    }

    updateBalance();
    updateInventory();
  </script>
</body>
</html>
