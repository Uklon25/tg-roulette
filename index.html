<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>AutoWin ‚Äî –†—É–ª–µ—Ç–∫–∞ –ø–æ–¥–∞—Ä–∫–æ–≤</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="robots" content="noindex">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            background: var(--tg-theme-bg-color, #121212);
            color: var(--tg-theme-text-color, #eee);
            font-family: Arial, sans-serif;
            min-height: 100vh;
            width: 100vw;
            overflow-x: hidden;
        }

        #main-content {
            flex: 1;
            width: 100vw;
            max-width: 500px;
            margin: 0 auto;
            box-sizing: border-box;
            padding-top: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .roulette-wrap {
            position: relative;
            width: 99vw;
            max-width: 420px;
            margin: 0 auto 22px auto;
            height: 110px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        #rouletteCanvas {
            border-radius: 18px;
            background: #191919;
            box-shadow: 0 0 14px #0a0;
            border: 2px solid #205b20;
        }

        .pointer-bar {
            position: absolute;
            left: 50%;
            top: -14px;
            width: 6px;
            height: 28px;
            transform: translateX(-50%);
            background: #0f0;
            border-radius: 5px 5px 12px 12px;
            box-shadow: 0 0 10px #0f0;
            z-index: 10;
        }

        #controls {
            margin-bottom: 12px;
            width: 100%;
            box-sizing: border-box;
            max-width: 340px;
            margin-left: auto;
            margin-right: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #luckButtons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 7px;
            margin-bottom: 8px;
        }

        #luckButtons button {
            min-width: 90px;
        }

        button {
            background: var(--tg-theme-button-color, #0a0);
            color: var(--tg-theme-button-text-color, #cfc);
            border: none;
            padding: 10px 12px;
            margin: 5px 3px;
            border-radius: 6px;
            font-weight: bold;
            font-size: 1em;
            cursor: pointer;
            transition: background 0.3s ease;
            min-width: 70px;
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        button:disabled {
            background: #444;
            cursor: not-allowed;
            opacity: 0.7;
        }

        #balance {
            font-size: 1.2em;
            margin-bottom: 12px;
            text-align: center;
        }

        #prizeInfo {
            font-size: 1.1em;
            margin-top: 12px;
            min-height: 60px;
            text-align: center;
            word-break: break-word;
        }

        #luckButtons button.active {
            background: #4caf50;
            box-shadow: 0 0 8px #4caf50;
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            width: 100vw;
            max-width: 500px;
            margin: 0 auto;
            z-index: 100;
            display: flex;
            justify-content: space-around;
            background: var(--tg-theme-secondary-bg-color, #222);
            border-top: 1px solid #333;
            padding: 0;
            height: 56px;
        }

        .bottom-nav button {
            flex: 1;
            margin: 0 2px;
            font-size: 1.05em;
            padding: 13px 0;
            border-radius: 5px;
            background: var(--tg-theme-bg-color, #111);
            color: var(--tg-theme-text-color, #eee);
            border: none;
            transition: background .25s;
            min-width: 0;
            min-height: 36px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .bottom-nav button.active {
            background: var(--tg-theme-button-color, #0a0);
            color: var(--tg-theme-button-text-color, #fff);
            box-shadow: 0 0 8px #0f0;
        }

        .inventory-list {
            display: flex;
            flex-direction: column;
            gap: 7px;
            margin-top: 10px;
            padding-bottom: 60px;
            width: 100%;
            align-items: stretch;
        }

        .inventory-item {
            background: var(--tg-theme-secondary-bg-color, #232323);
            border-radius: 8px;
            padding: 10px;
            display: flex;
            align-items: center;
            color: var(--tg-theme-text-color, #fff);
            font-size: 1em;
            border: 1px solid #333;
            margin: 3px 0;
            word-break: break-word;
            box-sizing: border-box;
            gap: 12px;
        }

        .profile-info {
            padding: 20px 0 8px 0;
            font-size: 1.1em;
            text-align: center;
            color: var(--tg-theme-text-color, #fff);
        }

        #tg-avatar {
            width: 72px;
            height: 72px;
            border-radius: 50%;
            background: #222;
            margin-bottom: 10px;
            display: none;
        }

        .sell-all-btn {
            width: 100%;
            box-sizing: border-box;
            background: #e33;
            color: #fff;
            font-weight: bold;
            margin-bottom: 6px;
            padding: 12px;
            border-radius: 8px;
            font-size: 1.07em;
            border: none;
            cursor: pointer;
        }

        h2 {
            color: var(--tg-theme-text-color, #fff);
            text-align: center;
        }

        @media (max-width: 600px) {
            #main-content {
                padding: 0;
            }
            .roulette-wrap {
                max-width: 100vw;
            }
            #controls {
                max-width: 98vw;
            }
            .inventory-item {
                min-width: 44vw;
                font-size: .99em;
            }
        }
    </style>
</head>
<body>
    <div id="main-content">
        <div id="profile" style="display:none;">
            <h2>–ü—Ä–æ—Ñ–∏–ª—å</h2>
            <div class="profile-info">
                <img id="tg-avatar" src="" alt="–ê–≤–∞—Ç–∞—Ä">
                <div>üë§ –ò–º—è: <span id="username">User</span></div>
                <div>üîó Username: <span id="usernick"></span></div>
                <div>üÜî ID: <span id="userid"></span></div>
                <div>‚≠ê –ë–∞–ª–∞–Ω—Å: <span id="balanceValueProfile">1000</span></div>
                <div id="addStarsBtnWrap" style="display:none;">
                    <button id="addStarsBtn">+1000 ‚≠ê</button>
                </div>
            </div>
        </div>

        <div id="roulette">
            <h2>–†—É–ª–µ—Ç–∫–∞ –ø–æ–¥–∞—Ä–∫–æ–≤</h2>
            <div id="balance">–ë–∞–ª–∞–Ω—Å: <span id="balanceValue">1000</span> ‚≠ê</div>
            
            <div class="roulette-wrap">
                <div class="pointer-bar"></div>
                <canvas id="rouletteCanvas"></canvas>
            </div>

            <div id="controls">
                <div id="luckButtons">
                    <button data-cost="25">–°—Ç–∞–≤–∫–∞ 25 ‚≠ê</button>
                    <button data-cost="50">–°—Ç–∞–≤–∫–∞ 50 ‚≠ê</button>
                    <button data-cost="100">–°—Ç–∞–≤–∫–∞ 100 ‚≠ê</button>
                </div>
                <div>
                    <button id="spinBtn" disabled>–ö—Ä—É—Ç–∏—Ç—å</button>
                    <button id="spinAgainBtn" style="display:none;">–ö—Ä—É—Ç–∏—Ç—å –µ—â—ë</button>
                </div>
            </div>

            <div id="prizeInfo"></div>
        </div>

        <div id="inventory" style="display:none;">
            <h2>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h2>
            <button class="sell-all-btn" id="sellAllBtn">–ü—Ä–æ–¥–∞—Ç—å –≤—Å—ë</button>
            <div id="inventoryCount" style="color:#eee;font-size:1.07em;margin-bottom:4px;text-align:center;width:100%"></div>
            <div id="inventoryList" class="inventory-list"></div>
        </div>
    </div>

    <nav class="bottom-nav">
        <button id="navProfile">–ü—Ä–æ—Ñ–∏–ª—å</button>
        <button id="navRoulette" class="active">–†—É–ª–µ—Ç–∫–∞</button>
        <button id="navInventory">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
    </nav>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ä—É–ª–µ—Ç–∫–∏
        const CANVAS_CONFIG = {
            width: 420,
            height: 90,
            itemWidth: 80,
            visibleItems: 7,
            animation: {
                duration: {
                    min: 3000,
                    max: 4000
                }
            }
        };

        // –ü—Ä–∏–∑—ã –∏ —à–∞–Ω—Å—ã
        const chances = {
            "25": [
                ["üß∏ –ü–ª—é—à–µ–≤—ã–π –º–∏—à–∫–∞", 15.37],
                ["‚ù§Ô∏è –°–µ—Ä–¥—Ü–µ —Å –±–∞–Ω—Ç–æ–º", 15.37],
                ["üéÅ –ü–æ–¥–∞—Ä–æ—á–Ω–∞—è –∫–æ—Ä–æ–±–∫–∞", 27],
                ["üåπ –ö—Ä–∞—Å–Ω–∞—è —Ä–æ–∑–∞", 27],
                ["üöÄ –†–∞–∫–µ—Ç–∞", 11.21],
                ["üçæ –®–∞–º–ø–∞–Ω—Å–∫–æ–µ", 11.21],
                ["üíç –ö–æ–ª—å—Ü–æ —Å –±—Ä–∏–ª–ª–∏–∞–Ω—Ç–æ–º", 20.86],
                ["‚ùå –ü—É—Å—Ç–∞—è —è—á–µ–π–∫–∞", -0.98]
            ],
            "50": [
                ["üß∏ –ü–ª—é—à–µ–≤—ã–π –º–∏—à–∫–∞", 2.08],
                ["‚ù§Ô∏è –°–µ—Ä–¥—Ü–µ —Å –±–∞–Ω—Ç–æ–º", 2.08],
                ["üéÅ –ü–æ–¥–∞—Ä–æ—á–Ω–∞—è –∫–æ—Ä–æ–±–∫–∞", 5.47],
                ["üåπ –ö—Ä–∞—Å–Ω–∞—è —Ä–æ–∑–∞", 5.47],
                ["üíê –ë—É–∫–µ—Ç —Ü–≤–µ—Ç–æ–≤", 14.5],
                ["üöÄ –†–∞–∫–µ—Ç–∞", 14.5],
                ["üçæ –®–∞–º–ø–∞–Ω—Å–∫–æ–µ", 14.5],
                ["üíç –ö–æ–ª—å—Ü–æ —Å –±—Ä–∏–ª–ª–∏–∞–Ω—Ç–æ–º", 11.48],
                ["üèÜ –ö—É–±–æ–∫", 11.48],
                ["üéÇ –¢–æ—Ä—Ç —Å —Å–≤–µ—á–∞–º–∏", 14.5],
                ["‚ùå –ü—É—Å—Ç–∞—è —è—á–µ–π–∫–∞", 0]
            ],
            "100": [
                ["üß∏ –ü–ª—é—à–µ–≤—ã–π –º–∏—à–∫–∞", -2.39],
                ["‚ù§Ô∏è –°–µ—Ä–¥—Ü–µ —Å –±–∞–Ω—Ç–æ–º", -2.39],
                ["üéÅ –ü–æ–¥–∞—Ä–æ—á–Ω–∞—è –∫–æ—Ä–æ–±–∫–∞", 0.02],
                ["üåπ –ö—Ä–∞—Å–Ω–∞—è —Ä–æ–∑–∞", 0.02],
                ["üíê –ë—É–∫–µ—Ç —Ü–≤–µ—Ç–æ–≤", 0.35],
                ["üöÄ –†–∞–∫–µ—Ç–∞", 0.35],
                ["üçæ –®–∞–º–ø–∞–Ω—Å–∫–æ–µ", 0.02],
                ["üíç –ö–æ–ª—å—Ü–æ —Å –±—Ä–∏–ª–ª–∏–∞–Ω—Ç–æ–º", 8],
                ["üèÜ –ö—É–±–æ–∫", 8],
                ["üéÇ –¢–æ—Ä—Ç —Å —Å–≤–µ—á–∞–º–∏", 0.02],
                ["üíé –ê–ª–º–∞–∑", 8],
                ["üéâ Happy B-day —Ç–∞–±–ª–∏—á–∫–∞", -5.5],
                ["‚ùå –ü—É—Å—Ç–∞—è —è—á–µ–π–∫–∞", 10]
            ]
        };

        const prizeValues = {
            "üß∏ –ü–ª—é—à–µ–≤—ã–π –º–∏—à–∫–∞": { emoji: "üß∏", label: "–ú–∏—à–∫–∞", price: 13 },
            "‚ù§Ô∏è –°–µ—Ä–¥—Ü–µ —Å –±–∞–Ω—Ç–æ–º": { emoji: "‚ù§Ô∏è", label: "–°–µ—Ä–¥—Ü–µ", price: 13 },
            "üéÅ –ü–æ–¥–∞—Ä–æ—á–Ω–∞—è –∫–æ—Ä–æ–±–∫–∞": { emoji: "üéÅ", label: "–ö–æ—Ä–æ–±–∫–∞", price: 21 },
            "üåπ –ö—Ä–∞—Å–Ω–∞—è —Ä–æ–∑–∞": { emoji: "üåπ", label: "–†–æ–∑–∞", price: 21 },
            "üíê –ë—É–∫–µ—Ç —Ü–≤–µ—Ç–æ–≤": { emoji: "üíê", label: "–ë—É–∫–µ—Ç", price: 42 },
            "üöÄ –†–∞–∫–µ—Ç–∞": { emoji: "üöÄ", label: "–†–∞–∫–µ—Ç–∞", price: 42 },
            "üçæ –®–∞–º–ø–∞–Ω—Å–∫–æ–µ": { emoji: "üçæ", label: "–®–∞–º–ø–∞–Ω—Å–∫–æ–µ", price: 42 },
            "üíç –ö–æ–ª—å—Ü–æ —Å –±—Ä–∏–ª–ª–∏–∞–Ω—Ç–æ–º": { emoji: "üíç", label: "–ö–æ–ª—å—Ü–æ", price: 84 },
            "üèÜ –ö—É–±–æ–∫": { emoji: "üèÜ", label: "–ö—É–±–æ–∫", price: 84 },
            "üéÇ –¢–æ—Ä—Ç —Å —Å–≤–µ—á–∞–º–∏": { emoji: "üéÇ", label: "–¢–æ—Ä—Ç", price: 84 },
            "üíé –ê–ª–º–∞–∑": { emoji: "üíé", label: "–ê–ª–º–∞–∑", price: 84 },
            "üéâ Happy B-day —Ç–∞–±–ª–∏—á–∫–∞": { emoji: "üéâ", label: "–¢–∞–±–ª–∏—á–∫–∞", price: 350 },
            "‚ùå –ü—É—Å—Ç–∞—è —è—á–µ–π–∫–∞": { emoji: "‚ùå", label: "–ü—É—Å—Ç–æ", price: 0 }
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        let balance = 1000;
        let inventory = [];
        let currentCost = null;
        let spinning = false;
        let currentPrize = null;
        let lastSpinDone = false;
        let currentPrizes = [];
        let tgUser = {};
        let tgUserId = null;

        // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã DOM
        const canvas = document.getElementById('rouletteCanvas');
        const ctx = canvas.getContext('2d');
        const balanceElem = document.getElementById("balanceValue");
        const prizeInfo = document.getElementById("prizeInfo");
        const luckButtons = [...document.querySelectorAll("#luckButtons button")];
        const spinBtn = document.getElementById("spinBtn");
        const spinAgainBtn = document.getElementById("spinAgainBtn");
        const sellAllBtn = document.getElementById("sellAllBtn");

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Canvas
        canvas.width = CANVAS_CONFIG.width;
        canvas.height = CANVAS_CONFIG.height;

        // –§—É–Ω–∫—Ü–∏–∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏
        function drawPrizeItem(prize, x, isActive) {
            // –§–æ–Ω —è—á–µ–π–∫–∏
            ctx.fillStyle = isActive ? '#35e535' : '#232323';
            ctx.fillRect(x, 0, CANVAS_CONFIG.itemWidth, CANVAS_CONFIG.height);
            
            // –ì—Ä–∞–Ω–∏—Ü—ã
            ctx.strokeStyle = '#205b20';
            ctx.lineWidth = 1;
            ctx.strokeRect(x, 0, CANVAS_CONFIG.itemWidth, CANVAS_CONFIG.height);

            // –≠–º–æ–¥–∑–∏
            ctx.font = '24px Arial';
            ctx.fillStyle = '#fff';
            ctx.textAlign = 'center';
            ctx.fillText(prize.emoji, x + CANVAS_CONFIG.itemWidth/2, 30);
            
            // –ù–∞–∑–≤–∞–Ω–∏–µ
            ctx.font = '14px Arial';
            ctx.fillText(prize.label, x + CANVAS_CONFIG.itemWidth/2, 55);
            
            // –¶–µ–Ω–∞
            ctx.font = '12px Arial';
            ctx.fillStyle = '#af8';
            ctx.fillText(`${prize.price} ‚≠ê`, x + CANVAS_CONFIG.itemWidth/2, 75);
        }

        function renderRoulette(activeIdx, prizesArr) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            prizesArr.forEach((prize, i) => {
                drawPrizeItem(prize, i * CANVAS_CONFIG.itemWidth, i === activeIdx);
            });
        }

        function generatePrizes(cost) {
            const chanceList = chances[cost];
            const prizes = [];
            let totalChance = 0;
            
            for (const item of chanceList) {
                const chance = Math.max(0, item[1]);
                totalChance += chance;
            }

            for (const [name, originalChance] of chanceList) {
                let chance = Math.max(0, originalChance);
                const prize = prizeValues[name];
                if (prize) {
                    prizes.push({ ...prize, chance });
                }
            }
            
            return prizes;
        }

        function getPrizeIdxAndView(prizes) {
            let totalChance = 0;
            prizes.forEach(prize => {
                totalChance += prize.chance;
            });

            let randomNumber = Math.random() * totalChance;
            let cumulativeChance = 0;
            let winIdx = 0;

            for (let i = 0; i < prizes.length; i++) {
                cumulativeChance += prizes[i].chance;
                if (randomNumber < cumulativeChance) {
                    winIdx = i;
                    break;
                }
            }

            let visible = [...prizes, ...prizes, ...prizes];
            let active = prizes.length + winIdx;
            
            return { winIdx, visible, active };
        }

        function animateRoulette(prizes, targetIdx, callback) {
            const startTime = performance.now();
            const duration = CANVAS_CONFIG.animation.duration.min + 
                Math.random() * (CANVAS_CONFIG.animation.duration.max - CANVAS_CONFIG.animation.duration.min);
            
            let currentOffset = 0;
            const targetOffset = CANVAS_CONFIG.itemWidth * targetIdx;

            function animate(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                // –ü–ª–∞–≤–Ω–æ–µ –∑–∞–º–µ–¥–ª–µ–Ω–∏–µ
                const easeOut = t => 1 - Math.pow(1 - t, 4);
                const ease = easeOut(progress);
                
                currentOffset = targetOffset * ease;
                
                // –û—á–∏—â–∞–µ–º –∏ —Ä–∏—Å—É–µ–º
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                prizes.forEach((prize, i) => {
                    const x = i * CANVAS_CONFIG.itemWidth - currentOffset;
                    const isCenter = Math.abs(x - canvas.width/2 + CANVAS_CONFIG.itemWidth/2) < CANVAS_CONFIG.itemWidth/2;
                    drawPrizeItem(prize, x, isCenter);
                });

                if (progress < 1) {
                    requestAnimationFrame(animate);
                } else {
                    callback && callback();
                }
            }

            requestAnimationFrame(animate);
        }

        function startSpin() {
            if (spinning) return;
            spinning = true;
            updateButtonsState();

            const {winIdx, visible, active} = getPrizeIdxAndView(currentPrizes);
            renderRoulette(-1, visible);

            setTimeout(() => {
                animateRoulette(visible, active + Math.floor(Math.random()*2), () => {
                    spinning = false;
                    updateButtonsState();
                    const winPrize = visible[Math.floor(CANVAS_CONFIG.visibleItems/2)];
                    showPrizeInfo(winPrize);
                    addToInventory(winPrize);
                });
            }, 10);
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        luckButtons.forEach(btn => {
            btn.onclick = () => {
                if (spinning) return;
                luckButtons.forEach(b => b.classList.remove("active"));
                btn.classList.add("active");
                currentCost = +btn.dataset.cost;
                currentPrizes = generatePrizes(currentCost);
                currentPrize = null;
                lastSpinDone = false;
                prizeInfo.textContent = "";
                updateButtonsState();
                const {visible} = getPrizeIdxAndView(currentPrizes);
                renderRoulette(Math.floor(CANVAS_CONFIG.visibleItems/2), visible);
            };
        });

        spinBtn.onclick = () => {
            if (spinning || !currentCost) return;
            if (balance < currentCost) {
                alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–∞–Ω—Å–∞ –¥–ª—è —Å—Ç–∞–≤–∫–∏!");
                return;
            }
            balance -= currentCost;
            updateBalance();
            startSpin();
            lastSpinDone = true;
            updateButtonsState();
        };

        spinAgainBtn.onclick = () => {
            if (spinning || !currentCost || balance < currentCost) return;
            prizeInfo.textContent = "";
            balance -= currentCost;
            updateBalance();
            startSpin();
            lastSpinDone = true;
            updateButtonsState();
        };

        sellAllBtn.onclick = () => {
            if (inventory.length === 0) return;
            let sum = 0;
            inventory.forEach(item => { sum += item.price; });
            balance += sum;
            updateBalance();
            inventory = [];
            updateInventory();
            updateInventoryCount();
        };

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function updateBalance() {
            balanceElem.textContent = balance;
            document.getElementById("balanceValueProfile").textContent = balance;
        }

        function updateButtonsState() {
            if (spinning) {
                spinBtn.style.display = "none";
                spinAgainBtn.style.display = "none";
                luckButtons.forEach(btn => btn.disabled = true);
                return;
            }
            
            spinBtn.style.display = lastSpinDone ? "none" : "";
            spinAgainBtn.style.display = lastSpinDone ? "" : "none";
            
            const canSpin = currentCost && balance >= currentCost;
            spinBtn.disabled = !canSpin;
            spinAgainBtn.disabled = !canSpin;
            luckButtons.forEach(btn => btn.disabled = false);
        }

        function showPrizeInfo(prize) {
            if (!prize || !prize.label) {
                prizeInfo.innerHTML = "–£–≤—ã, –ø—É—Å—Ç–æ.";
                return;
            }
            prizeInfo.innerHTML = `
                –í–∞—à –ø—Ä–∏–∑: <span style="font-size:1.28em">${prize.emoji} ${prize.label}</span><br>
                –¶–µ–Ω–∞: <b>${prize.price}‚≠ê</b>
            `;
        }

        function addToInventory(prize) {
            const invId = Math.random().toString(36).slice(2) + Date.now();
            inventory.push({ ...prize, invId });
            updateInventory();
            updateInventoryCount();
        }

        function updateInventory() {
            const invList = document.getElementById('inventoryList');
            invList.innerHTML = "";
            if (inventory.length === 0) {
                invList.innerHTML = `<div style="color:#888;">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç.</div>`;
                document.getElementById('sellAllBtn').disabled = true;
                return;
            }
            document.getElementById('sellAllBtn').disabled = false;
            inventory.forEach(item => {
                let div = document.createElement("div");
                div.className = "inventory-item";
                div.innerHTML = `
                    <span>${item.emoji} ${item.label} <span style="color:#aaa;">(${item.price} ‚≠ê)</span></span>
                `;
                invList.appendChild(div);
            });
        }

        function updateInventoryCount() {
            document.getElementById('inventoryCount').textContent =
                `üéÅ –ü—Ä–µ–¥–º–µ—Ç–æ–≤ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ: ${inventory.length}`;
        }

        function updateProfile() {
            let user = (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initDataUnsafe && window.Telegram.WebApp.initDataUnsafe.user);
            if (user) {
                tgUser = user;
                tgUserId = user.id;
            } else {
                tgUser = {first_name: "–ì–æ—Å—Ç—å", username: "", id: 0};
                tgUserId = 0;
            }
            
            document.getElementById("username").textContent = tgUser.first_name;
            document.getElementById("usernick").textContent = tgUser.username || "";
            document.getElementById("userid").textContent = tgUser.id;
            
            let avatar = document.getElementById("tg-avatar");
            if (tgUser.photo_url) {
                avatar.src = tgUser.photo_url;
                avatar.style.display = "";
            } else {
                avatar.style.display = "none";
            }
        }

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è
        const navBtns = {
            profile: document.getElementById("navProfile"),
            roulette: document.getElementById("navRoulette"),
            inventory: document.getElementById("navInventory")
        };

        const screens = {
            profile: document.getElementById("profile"),
            roulette: document.getElementById("roulette"),
            inventory: document.getElementById("inventory")
        };

        function showScreen(screen) {
            Object.keys(screens).forEach(k => {
                screens[k].style.display = (k === screen) ? "" : "none";
                navBtns[k].classList.toggle("active", k === screen);
            });
            if (screen === "profile") updateProfile();
            if (screen === "inventory") {
                updateInventory();
                updateInventoryCount();
            }
        }

        navBtns.profile.onclick = () => showScreen("profile");
        navBtns.roulette.onclick = () => showScreen("roulette");
        navBtns.inventory.onclick = () => showScreen("inventory");

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.onload = () => {
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.ready();
                window.Telegram.WebApp.expand();
            }
            
            updateBalance();
            updateButtonsState();
            if (luckButtons.length > 0) {
                luckButtons[0].click();
            }
        };
    </script>
</body>
</html>
